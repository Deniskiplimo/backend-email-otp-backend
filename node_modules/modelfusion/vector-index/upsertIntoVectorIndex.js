import { nanoid as createId } from "nanoid";
import { embedMany } from "../model-function/embed/embed.js";
export async function upsertIntoVectorIndex({ vectorIndex, embeddingModel, generateId = createId, objects, getValueToEmbed, getId, }, options) {
    // many embedding models support bulk embedding, so we first embed all texts:
    const embeddings = await embedMany(embeddingModel, objects.map(getValueToEmbed), options);
    await vectorIndex.upsertMany(objects.map((object, i) => ({
        id: getId?.(object, i) ?? generateId(),
        vector: embeddings[i],
        data: object,
    })));
}
