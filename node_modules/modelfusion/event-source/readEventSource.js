import { safeParseJsonWithSchema } from "../util/parseJSON.js";
export function readEventSource({ url, schema, onEvent, onError = console.error, }) {
    const eventSource = new EventSource(url);
    eventSource.onmessage = (e) => {
        try {
            const parseResult = safeParseJsonWithSchema(e.data, schema);
            if (!parseResult.success) {
                onError(parseResult.error, eventSource);
                return;
            }
            onEvent(parseResult.data, eventSource);
        }
        catch (error) {
            onError(error, eventSource);
        }
    };
    eventSource.onerror = (e) => {
        onError(e, eventSource);
    };
}
