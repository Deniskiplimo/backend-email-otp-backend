"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readEventSource = void 0;
const parseJSON_js_1 = require("../util/parseJSON.cjs");
function readEventSource({ url, schema, onEvent, onError = console.error, }) {
    const eventSource = new EventSource(url);
    eventSource.onmessage = (e) => {
        try {
            const parseResult = (0, parseJSON_js_1.safeParseJsonWithSchema)(e.data, schema);
            if (!parseResult.success) {
                onError(parseResult.error, eventSource);
                return;
            }
            onEvent(parseResult.data, eventSource);
        }
        catch (error) {
            onError(error, eventSource);
        }
    };
    eventSource.onerror = (e) => {
        onError(e, eventSource);
    };
}
exports.readEventSource = readEventSource;
